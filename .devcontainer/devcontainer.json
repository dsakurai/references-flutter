{
    "name": "Dev Container",
    // Use Compose so we can run MariaDB alongside the dev container
    "dockerComposeFile": [
        "compose.yaml"
    ],
    // Ensure DB starts with the dev container
    "service": "dev",

    "runServices": ["db"],

    // Open VSCode at this folder
    "workspaceFolder": "/workspace",
    "initializeCommand": "echo WORKSPACE=${localWorkspaceFolder} > .devcontainer/.env",

    "remoteUser": "vscode",
    
    "postCreateCommand": "cd /workspace/webapp && flutter pub get && cd /workspace/server && dart pub get && dart --disable-analytics && cd /workspace/database && ./create-table.sh",

    "features": {
        "git": "os-provided", // Enable VSCode functionality to re-use git credentials: https://stackoverflow.com/a/73327749
        "sshd": "latest"      // "Add a SSH server into a container so that you can use an external terminal, sftp, or SSHFS to interact with it." https://github.com/microsoft/vscode-dev-containers/blob/main/script-library/docs/sshd.md
    },

    "customizations": {
        "vscode": {
            "extensions": [
                "docsmsft.docs-yaml",
                "Dart-Code.flutter"
            ]
        }
    },
    // In the hope of shutting down containers before rebuilding them
    "shutdownAction": "stopCompose"
}
